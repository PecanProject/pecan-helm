{{- if .Values.models }}
{{- $fullname := include "pecan.fullname" . }}
{{- range $key, $val := .Values.models }}
{{- if .enabled }}
---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: "{{ $fullname }}-model-{{ $key }}-scaledobject"
  namespace: default
spec:
  scaleTargetRef:
    deploymentName: {{ $fullname }}-model-{{ $key }}
    containerName: {{ $.Chart.Name }}-model-{{ $key }}
  minReplicaCount: "{{ .minReplicaCount }}"
  maxReplicaCount: "{{ .maxReplicaCount }}"
  triggers:
  - type: rabbitmq
    metadata:
      protocol: http
      queueName: "{{ .queuename }}"
      mode: QueueLength
      value: {{ $fullname }}-model-{{ $key }}
    authenticationRef:
      name: {{ $.Values.keda.rabbitmq.name }}-triger-auth
{{- end }}
{{- end }}
{{- end }}
